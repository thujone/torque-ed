# DOMAIN_MODEL.md - Business Logic & Rules

## Overview

This document defines the business rules, domain logic, and terminology used throughout TorqueEd. It serves as the authoritative source for understanding how the automotive education domain is modeled in the system.

## Core Concepts

### Educational Hierarchy

```
School System
    └── Schools
            └── Courses
                    └── Classes (instances of courses per semester)
                            └── Students (via Enrollments)
```

### Time-Based Concepts

- **Academic Year**: Typically consists of Fall, Spring, and Summer semesters
- **Semester**: A discrete time period containing classes (e.g., "Fall 2025")
- **Class Meeting**: A single scheduled session of a class
- **Holiday**: Days when no classes meet
- **Midterm Period**: Date range for midterm exams
- **Final Period**: Date range for final exams

## Business Rules

### User Management Rules

#### Role Hierarchy
1. **Super Admin**
   - Can perform any action in the system
   - Typically IT staff or system administrators
   - Limited to 2-3 users per school system

2. **Admin**
   - Manages schools, courses, and semesters
   - Can create instructor accounts
   - Usually department heads
   - Cannot modify super admin accounts

3. **Instructor**
   - Manages their assigned classes
   - Can add/drop students with notification
   - Can cancel individual class meetings
   - Cannot create courses or modify semester dates

4. **Teaching Assistant**
   - Can mark attendance
   - Read-only access to class rosters
   - Cannot modify enrollments
   - Future: Can enter grades under instructor supervision

#### Multi-Role Rules
- Users can have different roles in different contexts
- A person can be a TA in one class while enrolled as a student in another
- Role conflicts are resolved by most restrictive access
- Instructors cannot be students in their own classes

### Enrollment Management

#### Enrollment States
```
Waitlisted → Enrolled → Dropped
    ↓           ↓
    └───────────┘
```

#### Enrollment Rules
1. **Capacity Management**
   - Classes have a maximum enrollment limit
   - When full, new enrollments go to waitlist
   - Waitlist maintains FIFO order
   - Dropping a student may auto-promote from waitlist

2. **Add/Drop Rules**
   - Students can be added until 2 weeks after semester start
   - Drops are allowed until 60% through the semester
   - Late adds require admin approval
   - Dropped students retain historical attendance records

3. **Waitlist Management**
   - Waitlist position is strictly ordered
   - Students cannot skip positions
   - Instructor can override waitlist order with admin notification
   - Waitlist clears at semester end

### Attendance Tracking

#### Attendance States
- **Present**: Student checked in via QR or manual entry
- **Absent**: No check-in recorded (default)
- **Excused**: Absence marked as excused by instructor/admin

#### Attendance Rules
1. **Marking Attendance**
   - Can only mark attendance for scheduled meetings
   - Past attendance can be edited up to 30 days
   - Future attendance cannot be marked
   - Same QR code cannot be scanned twice for same meeting

2. **QR Code Rules**
   - Each student has one permanent QR code
   - QR codes are UUIDs for security
   - Lost QR codes can be regenerated by admin
   - QR codes work across all enrolled classes

3. **Attendance Window**
   - Attendance can be marked from 30 minutes before class
   - Late arrival tracking not implemented in Phase A
   - No automatic absent marking (instructor discretion)

### Scheduling Rules

#### Class Meeting Generation
1. **Recurrence Patterns**
   - Simple weekly patterns only (MWF, TTh, etc.)
   - No bi-weekly or monthly patterns in Phase A
   - Meetings generated for entire semester at creation

2. **Holiday Handling**
   - Holidays block meeting generation
   - Existing meetings on new holidays are cancelled
   - Holiday changes don't affect past meetings

3. **Meeting Modifications**
   - Individual meetings can be cancelled
   - Cancelled meetings cannot be restored
   - Time changes affect future meetings only
   - Room changes can be per-meeting or permanent

#### Schedule Validation
- Classes cannot overlap in the same room
- Instructor cannot have overlapping classes
- Minimum 15 minutes between back-to-back classes
- Maximum 4 hours per class meeting

### Course Management

#### Course Rules
1. **Course Codes**
   - Must follow pattern: DEPT-### (e.g., AUTO-302)
   - Codes are unique within school system
   - Cannot change code after classes exist

2. **Course Sharing**
   - Courses can be shared across schools in system
   - Changes to course affect all schools
   - Schools can override course descriptions locally

3. **Prerequisites**
   - Stored as free text in Phase A
   - Not enforced by system
   - For informational purposes only

### Data Validation Rules

#### Required Fields
- All person names (first and last)
- Email addresses (must be valid format)
- Course codes and names
- Class section identifiers
- Semester dates
- Meeting schedules

#### Unique Constraints
- Email addresses (system-wide)
- Student IDs (system-wide)
- QR codes (system-wide)
- Course codes (per school system)
- Class sections (per course per semester)

#### Date/Time Rules
- Semester end date must be after start date
- Midterm period within semester dates
- Final period after midterm period
- Class meetings within semester dates
- Historical dates cannot be modified

### Notification Rules

#### Mandatory Notifications
1. **Enrollment Changes**
   - Student added: → Instructor, Admin
   - Student dropped: → Instructor, Admin, Student
   - Waitlist promotion: → Student

2. **Schedule Changes**
   - Meeting cancelled: → All enrolled students
   - Time/room change: → All enrolled students
   - Instructor change: → All enrolled students

#### Notification Delivery
- Email is primary channel
- Sent asynchronously
- Failures logged but don't block operations
- No delivery confirmation required

### Security & Privacy Rules

#### FERPA Compliance
1. **Data Access**
   - Students can only see their own records (future)
   - Instructors see only their class rosters
   - TAs have read-only access to attendance
   - Cross-class data requires admin role

2. **Data Retention**
   - Attendance records kept indefinitely
   - Dropped student data retained
   - Audit logs kept for 7 years
   - PII deletion by request only

#### Multi-Tenant Isolation
- No data sharing between school systems
- Separate subdomains per system (future)
- User accounts scoped to school system
- No global super admin role

### Business Logic Flows

#### Student Enrollment Flow
```
1. Admin/Instructor initiates add
2. Check enrollment capacity
3. If full → Add to waitlist
4. If space → Create enrollment
5. Send notifications
6. Update attendance grid
```

#### Attendance Marking Flow
```
1. QR scanned → Extract student identifier
2. Verify student enrolled in class
3. Check meeting is today
4. Create/update attendance record
5. Update UI optimistically
6. Handle conflicts (duplicate scan)
```

#### Semester Setup Flow
```
1. Admin creates semester with dates
2. Define holidays and break periods
3. Create courses or reuse existing
4. Create class sections with schedules
5. System generates all meetings
6. Assign instructors and TAs
7. Open for enrollment
```

### Reporting Rules

#### Attendance Reports
- Percentage calculated as Present/(Present+Absent)
- Excused absences don't count against percentage
- Minimum 70% attendance for passing (configurable)
- Reports exportable as CSV

#### Enrollment Reports
- Current enrollment vs capacity
- Waitlist lengths
- Drop rates by class
- Historical trends by semester

### Future Phase Considerations

#### Phase B (Grading)
- Grades attached to enrollments
- Multiple grade types (assignments, exams)
- Weighted grade calculations
- Grade submission deadlines

#### Phase C (Coursework)
- Competency-based progression
- Video submission requirements
- Skill verification workflows
- Industry certification tracking

## Glossary

- **Class**: A specific instance of a course in a semester (e.g., "AUTO-302 Morning Section")
- **Course**: A curriculum unit with specific learning objectives (e.g., "AUTO-302 Transmission Repair")
- **Enrollment**: A student's registration in a specific class
- **Meeting**: A single scheduled session of a class
- **QR Code**: Quick Response code used for student identification
- **School System**: A collection of related schools (e.g., a community college district)
- **Section**: An identifier for different instances of the same course
- **Semester**: An academic term (Fall, Spring, Summer)
- **TA**: Teaching Assistant
- **Waitlist**: Ordered queue of students waiting for enrollment space